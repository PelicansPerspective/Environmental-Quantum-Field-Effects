<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#1a237e">
    
    <!-- Preload critical resources to avoid flash of unstyled content -->
    <link rel="preload" href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700' as="style">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" as="style">
    <link rel="preload" href="{{ '/assets/css/style.css?v=' | append: site.github.build_revision | relative_url }}" as="style">
    <link rel="preload" href="{{ '/assets/css/eqfe-core.css?v=' | append: site.github.build_revision | relative_url }}" as="style">
    <link rel="preload" href="{{ '/assets/css/interactive.css?v=' | append: site.github.build_revision | relative_url }}" as="style">
    
    <!-- Load stylesheets -->
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="{{ '/assets/css/style.css?v=' | append: site.github.build_revision | relative_url }}">
    <link rel="stylesheet" href="{{ '/assets/css/eqfe-core.css?v=' | append: site.github.build_revision | relative_url }}">
    <link rel="stylesheet" href="{{ '/assets/css/interactive.css?v=' | append: site.github.build_revision | relative_url }}">
    
    <title>{% if page.title %}{{ page.title | escape }} | EQFE{% else %}{{ site.title | escape }}{% endif %}</title>
    <meta name="description" content="{{ page.excerpt | default: site.description | strip_html | normalize_whitespace | truncate: 160 | escape }}">
    <meta name="keywords" content="quantum physics, quantum field theory, quantum biology, quantum computing, quantum correlations">
    <link rel="icon" type="image/png" href="{{ '/assets/images/favicon.png' | relative_url }}">
    
    <!-- Preload critical JavaScript -->
    <link rel="preload" href="https://cdn.plot.ly/plotly-latest.min.js" as="script">
    <link rel="preload" href="https://code.jquery.com/jquery-3.6.0.min.js" as="script">
    <link rel="preload" href="{{ '/assets/js/eqfe-core.js?v=' | append: site.github.build_revision | relative_url }}" as="script">
    <link rel="preload" href="{{ '/assets/js/eqfe-visualizations.js?v=' | append: site.github.build_revision | relative_url }}" as="script">
    
    <!-- Critical rendering path scripts -->
    <script>
      // Inline script to prevent flash of unstyled content
      document.documentElement.className = 'js-loading';
      window.addEventListener('DOMContentLoaded', function() {
        document.documentElement.className = document.documentElement.className.replace('js-loading', 'js-loaded');
      });
      
      // Check for WebP support and convert images
      (function() {
        // Feature detection for WebP support
        var WebP = new Image();
        WebP.onload = WebP.onerror = function() {
          if (WebP.height == 2) {
            // WebP is supported
            var images = document.querySelectorAll('img[data-webp-src]');
            images.forEach(function(img) {
              img.src = img.getAttribute('data-webp-src');
            });
            document.documentElement.className += ' webp';
          } else {
            // WebP is not supported
            document.documentElement.className += ' no-webp';
          }
        };
        WebP.src = 'data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA';
      })();
      
      // Set max-width for all images and lazy load them
      window.addEventListener('load', function() {
        // Find all images and add style attributes
        var allImages = document.querySelectorAll('img:not([style])');
        allImages.forEach(function(img) {
          img.style.maxWidth = '100%';
          img.style.height = 'auto';
          
          // Add lazy loading if browser supports it
          if ('loading' in HTMLImageElement.prototype) {
            img.loading = 'lazy';
          }
        });
      });
    </script>
    
    <!-- Load JavaScript libraries -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js" defer></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" defer></script>
    <script src="{{ '/assets/js/eqfe-core.js?v=' | append: site.github.build_revision | relative_url }}" defer></script>
    <script src="{{ '/assets/js/eqfe-visualizations.js?v=' | append: site.github.build_revision | relative_url }}" defer></script>
    
    <!-- MathJax Configuration -->
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']],
          processEscapes: true,
          processEnvironments: true
        },
        svg: {
          fontCache: 'global'
        }
      };
    </script>
    <script type="text/javascript" id="MathJax-script" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
    </script>
  </head>
  <body>
    <section class="page-header">
      <div class="header-content">
        <h1 class="project-name">{{ site.title }}</h1>
        <h2 class="project-tagline">{{ site.description }}</h2>
        
        <nav class="site-nav">
          <a href="{{ site.baseurl }}/" class="btn"><i class="fas fa-home"></i> Home</a>
          <a href="{{ site.baseurl }}/getting_started.html" class="btn"><i class="fas fa-book"></i> Documentation</a>
          <a href="{{ site.baseurl }}/theory.html" class="btn"><i class="fas fa-square-root-alt"></i> Theory</a>
          <a href="{{ site.baseurl }}/api_reference.html" class="btn"><i class="fas fa-code"></i> API</a>
          <a href="{{ site.baseurl }}/project_roadmap.html" class="btn"><i class="fas fa-map"></i> Roadmap</a>
          <a href="{{ site.baseurl }}/visualization_assets/index.html" class="btn"><i class="fas fa-chart-line"></i> Visualizations</a>
          <a href="{{ site.baseurl }}/REVOLUTIONARY_FINDINGS.html" class="btn"><i class="fas fa-lightbulb"></i> Findings</a>
          <a href="https://github.com/PelicansPerspective/Environmental-Quantum-Field-Effects" class="btn"><i class="fab fa-github"></i> GitHub</a>
        </nav>
      </div>
    </section>

    <section class="main-content">
      {{ content }}
      
      <!-- Email signup section before footer -->
      <div class="email-signup">
        <h3><i class="fas fa-envelope-open-text"></i> Stay Updated on EQFE Research</h3>
        <p>Receive notifications about new simulations, theoretical advances, and experimental validations.</p>
        <form class="email-form" id="email-signup-form" action="https://formspree.io/f/{{ site.formspree_id | default: 'your-formspree-id' }}" method="POST">
          <input type="email" name="email" placeholder="Your email address" required>
          <button type="submit"><i class="fas fa-paper-plane"></i> Subscribe</button>
        </form>
      </div>
      
      <footer class="site-footer">
        <div class="footer-branding">
          <h3>Environmental Quantum Field Effects</h3>
          <p>Exploring the frontier of quantum correlation amplification</p>
        </div>
        
        <div class="footer-links">
          <a href="https://github.com/PelicansPerspective" title="GitHub"><i class="fab fa-github"></i></a>
          <a href="{{ '/CITATIONS' | relative_url }}" title="Citations"><i class="fas fa-quote-right"></i></a>
          <a href="mailto:{{ site.contact }}" title="Email"><i class="fas fa-envelope"></i></a>
        </div>
        
        <span class="site-footer-owner"><a href="{{ site.github.repository_url }}">{{ site.title }}</a> is maintained by <a href="{{ site.github.owner_url }}">{{ site.author }}</a>.</span>
        <span class="site-footer-credits">Contact: <a href="mailto:{{ site.contact }}">{{ site.contact }}</a></span>
        <span class="copyright">&copy; {{ 'now' | date: "%Y" }} Pelicans Perspective. All rights reserved.</span>
      </footer>
    </section>

    <!-- Enhanced floating back to top button -->
    <button id="back-to-top" title="Back to Top"><i class="fas fa-arrow-up"></i></button>
    
    <!-- Loading skeleton overlay -->
    <div class="content-skeleton">
      <div class="spinner"></div>
      <p>Loading EQFE content...</p>
    </div>
    </script>

    {% if site.google_analytics %}
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', '{{ site.google_analytics }}', 'auto');
        ga('send', 'pageview');
      </script>
    {% endif %}
  </body>
</html>
